_N_E=(window.webpackJsonp_N_E=window.webpackJsonp_N_E||[]).push([[13],{"R+4x":function(e,t,n){"use strict";n.r(t);var o=n("KQm4"),a=n("o0o1"),r=n.n(a),s=n("HaE+"),i=n("1OyB"),c=n("vuIU"),l=n("JX7q"),u=n("Ji7U"),d=n("md7G"),p=n("foSv"),h=n("q1tI"),f=n.n(h),y=n("3r0M"),m=n("YIMM"),b=n("iUi7"),g=n("/Ina"),k=n("wX7S"),v=n("iY3s"),w=n("Skks"),x=n("mFTT"),S=n("WZt7"),O=n("g4pe"),T=n.n(O),j=f.a.createElement;function C(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,o=Object(p.a)(e);if(t){var a=Object(p.a)(this).constructor;n=Reflect.construct(o,arguments,a)}else n=o.apply(this,arguments);return Object(d.a)(this,n)}}var A=function(e){return null==e||0==e.length},P={mainPadding:{padding:"0px 2em"},mainSidePadding:{padding:"10px 2em"},mainPdf:{display:"flex",justifyContent:"center"},mainTable:{backgroundColor:"#fff",border:"1px solid #d8e2f0",borderRadius:"4px",boxShadow:"0 0 10px 0 rgba(19,29,41,.05)",position:"relative",padding:"0em 3em 2em"},backButton:{cusor:"pointer"},label:{fontWeight:"bold"}},I={en:{heading:"Moneybird Configuration",apiSection:{title:j("label",{style:P.label},"API Token"),description:j("span",null,"This is the API Token for you MoneyBird Account. You can generate one ",j("a",{target:"_blank",href:"https://moneybird.com/user/applications/new"},"here")," for personal use."),succsess:"API Token is vaild",fail:"API Token NOT vaild",placeholder:"API Token",show:"Click to choose another api key"},contactSection:{title:j("label",{style:P.label},"Contact"),description:j("span",null,"The contact whos data will show up on the tab"),placeholder:"Choose a Contact"},typeSection:{title:j("label",{style:P.label},"Data Type"),description:j("span",null,"The types of data to show notifcations for")},deleteDialog:{cancel:"Cancel",confirm:"Yes",header:"Delete API Key",message:function(e){return"Are you sure you want to delete ".concat(e)}},types:["Invoices","Quotes","Hours"]},nl:{heading:"Moneybird Koppelen",apiSection:{title:j("label",{style:P.label},"API token invoeren"),description:j("span",null,"Vul hier een API-token in van je Moneybird account. Je kunt ",j("a",{target:"_blank",href:"https://moneybird.com/user/applications/new"},"hier")," een API-token genereren. Vul een naam in die herkenbaar is voor deze connectie, bijvoorbeeld \u2018Microsoft Teams Integratie\u2019. Kies voor \u2018API token voor persoonlijk gebruik\u2019 en geef toegang voor alle onderdelen. Vervolgens verschijnt er een API-token in beeld. Vul deze hieronder in."),succsess:"API-token is geldig",fail:"API-token niet geldig",placeholder:"API token invoeren",show:"Klik om een \u200b\u200bandere API-sleutel te kiezen"},contactSection:{title:j("label",{style:P.label},"Contact"),description:j("span",null,"Selecteer de Contact waarvan je de gegevens wilt tonen in de Tab."),placeholder:"Kies een Contact"},typeSection:{title:j("label",{style:P.label},"Data Type"),description:j("span",null,"Het type gegevens dat op het tabblad moet worden weergegeven")},deleteDialog:{cancel:"Annuleren",confirm:"Ja",header:"API-sleutel verwijderen",message:function(e){return"Weet je zeker dat je wilt verwijderen ".concat(e)}},types:["Facturen","Offertes","Uren"]}},K=function(e){Object(u.a)(n,e);var t=C(n);function n(){var e;return Object(i.a)(this,n),(e=t.call(this)).microsoftTeams&&e.microsoftTeams.initialize(),e.state={apiKey:"",adminId:null,admins:null,admin:null,contacts:null,contact:null,loadingContacts:!1,keys:[],isNew:!1,isOpen:!1,isContactsOpen:!1,locale:null,tabType:"invoices",showApiKeys:!1,loaded:!1,forHours:!1,forInvoices:!1,forQuotes:!1},e.addWebhookToMoneybird=e.addWebhookToMoneybird.bind(Object(l.a)(e)),e.setUpWebhook=e.setUpWebhook.bind(Object(l.a)(e)),e.deleteKeyFromDb=e.deleteKeyFromDb.bind(Object(l.a)(e)),e.createKeyEntry=e.createKeyEntry.bind(Object(l.a)(e)),e.getAdmin=e.getAdmin.bind(Object(l.a)(e)),e.getOptions=e.getOptions.bind(Object(l.a)(e)),e.getContacts=e.getContacts.bind(Object(l.a)(e)),e.getAdminAndContacts=e.getAdminAndContacts.bind(Object(l.a)(e)),e.updateContact=e.updateContact.bind(Object(l.a)(e)),e}return Object(c.a)(n,[{key:"componentDidMount",value:function(){var e=Object(s.a)(r.a.mark((function e(){var t=this;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.microsoftTeams=window?window.microsoftTeams:null,this.microsoftTeams.initialize(),this.microsoftTeams.getContext(function(){var e=Object(s.a)(r.a.mark((function e(n){var o,a,i,c,l;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=n.tid,a=n.locale,e.prev=1,e.next=4,fetch("https://moneybirdproxymaatwerk.azurewebsites.net/api/key/".concat(o),{mode:"cors",method:"GET"});case 4:return i=e.sent,e.next=7,i.json();case 7:c=e.sent,console.log({json:c}),l=c.map((function(e){return{content:j("div",null,j("span",{style:{cursor:"pointer"},class:"lnr lnr-trash",onClick:function(){return t.setState({deleteKey:e.key,isOpen:!1})}})," - ",j("span",{style:{cursor:"pointer"},onClick:Object(s.a)(r.a.mark((function n(){return r.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,t.getAdminAndContacts(e.key);case 2:case"end":return n.stop()}}),n)})))},e.key)),key:e.key}})),console.log({keys:l}),t.setState({keys:l,tid:o,locale:a}),e.next=18;break;case 14:e.prev=14,e.t0=e.catch(1),console.log("BOO"),console.log(e.t0);case 18:case"end":return e.stop()}}),e,null,[[1,14]])})));return function(t){return e.apply(this,arguments)}}().bind(this));case 3:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getForDataTypes",value:function(){var e=this.state,t=e.forInvoices,n=e.forQuotes,o=e.forHours,a=[],r=[];return t&&(a.push("i"),r.push("sales_invoice_created")),n&&(a.push("q"),r.push("estimate_created")),o&&(a.push("h"),r.push("time_entry_created"),r.push("time_entry_updated")),{urlParam:a.join("-"),events:r}}},{key:"getAdminAndContacts",value:function(){var e=Object(s.a)(r.a.mark((function e(t){return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getAdmin(t);case 2:return e.sent,e.next=5,this.getContacts();case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"updateContact",value:function(e,t){var n=this,o=t.value,a=this.state.apiKey;this.setState({contact:o},(function(){return n.setUpWebhook(a)}))}},{key:"getContacts",value:function(){var e=Object(s.a)(r.a.mark((function e(t,n){var o,a,s,i,c,l,u,d;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(o=this.state,a=o.apiKey,s=o.adminId,!n){e.next=21;break}return i=n.searchQuery,e.prev=3,this.setState({loadingContacts:!0}),e.next=7,fetch("https://moneybirdproxymaatwerk.azurewebsites.net/api/MoneyBirdProxy",{mode:"cors",method:"POST",body:JSON.stringify({method:"GET",path:"".concat(s,"/contacts.json").concat(A(i)?"":"?query="+i),key:a})});case 7:return c=e.sent,e.next=10,c.json();case 10:l=e.sent,console.log({json:l}),this.setState({contacts:l,loadingContacts:!1}),e.next=19;break;case 15:e.prev=15,e.t0=e.catch(3),console.log("BOOM!"),console.log(e.t0);case 19:e.next=33;break;case 21:if(!t){e.next=25;break}this.setState({contact:t.value},this.save),e.next=33;break;case 25:return e.next=27,fetch("https://moneybirdproxymaatwerk.azurewebsites.net/api/MoneyBirdProxy",{mode:"cors",method:"POST",body:JSON.stringify({method:"GET",path:"".concat(s,"/contacts.json"),key:a})});case 27:return u=e.sent,e.next=30,u.json();case 30:d=e.sent,console.log({json:d}),this.setState({contacts:d,isOpen:!1});case 33:case"end":return e.stop()}}),e,this,[[3,15]])})));return function(t,n){return e.apply(this,arguments)}}()},{key:"addWebhookToMoneybird",value:function(){var e=Object(s.a)(r.a.mark((function e(t,n,o,a){var s,i,c,l,u,d;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s=this.state,i=s.locale,c=s.contact,l=c.value,console.log("AHHHHHHH!!!"),console.log({events:a}),console.log({locale:i}),console.log({contactId:l}),console.log("https://moneybirdproxymaatwerk.azurewebsites.net/api/teams/".concat(u,"/").concat(a.urlParam,"/").concat(l,"/").concat(o)),u=i?i.split("-")[0]:"en",e.next=10,fetch("https://moneybirdproxymaatwerk.azurewebsites.net/api/MoneyBirdProxy",{mode:"cors",method:"POST",body:JSON.stringify({method:"POST",path:"".concat(n,"/webhooks.json"),key:t,data:{url:"https://moneybirdproxymaatwerk.azurewebsites.net/api/teams/".concat(u,"/").concat(a.urlParam,"/").concat(l,"/").concat(o),events:a.events}})});case 10:return d=e.sent,console.log("AHHHHHHH!!!"),e.next=14,d.json();case 14:return e.abrupt("return",e.sent);case 15:case"end":return e.stop()}}),e,this)})));return function(t,n,o,a){return e.apply(this,arguments)}}()},{key:"getAdmin",value:function(){var e=Object(s.a)(r.a.mark((function e(t){var n,o,a=arguments;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a.length>1&&void 0!==a[1]&&a[1],e.prev=1,e.next=4,fetch("https://moneybirdproxymaatwerk.azurewebsites.net/api/MoneyBirdProxy",{mode:"cors",method:"POST",body:JSON.stringify({method:"GET",path:"administrations.json",key:t})});case 4:return n=e.sent,e.next=7,n.json();case 7:if(!(o=e.sent).error){e.next=12;break}this.setState({admins:!1,isOpen:!1,contacts:null}),e.next=14;break;case 12:return this.setState({admin:o[0],adminId:o[0].id,admins:!0}),e.abrupt("return",o[0].id);case 14:e.next=19;break;case 16:e.prev=16,e.t0=e.catch(1),console.log(e.t0);case 19:case"end":return e.stop()}}),e,this,[[1,16]])})));return function(t){return e.apply(this,arguments)}}()},{key:"setUpWebhook",value:function(){var e=Object(s.a)(r.a.mark((function e(t){var n=this;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.setState({apiKey:t,isOpen:!1}),console.log("SETUPWEBHOOK"),this.microsoftTeams.settings.setValidityState(!0),console.log("saved"),this.microsoftTeams.settings.registerOnSaveHandler(function(e){console.log("REGISTERSAVEHANDLER"),n.microsoftTeams.getContext(function(o){console.log("GETCONTEXT");var a=o.teamId,i=o.channelId,c=n.getForDataTypes();if(A(c.urlParam))e.notifyFailure("Must select a event type to recive notifcations");else{var l="connector-moneybird-".concat(a,"-").concat(i);n.microsoftTeams.settings.setSettings({contentUrl:"https://jp5525.github.io/teams-moneybird-interface/connector",entityId:l,configName:"Moneybird"}),n.microsoftTeams.settings.getSettings(function(){var o=Object(s.a)(r.a.mark((function o(a){var s,i,l,u,d;return r.a.wrap((function(o){for(;;)switch(o.prev=o.next){case 0:return s=a.webhookUrl,i=/webhook\/(.*)/.exec(s),l=encodeURIComponent(i[1]),console.log({webhookUrl:s}),o.next=6,n.getAdmin(t);case 6:return u=o.sent,o.next=9,n.addWebhookToMoneybird(t,u,encodeURIComponent(l),c);case 9:d=o.sent,console.log({webhook:d}),e.savenotifyAppLoaded(),e.notifySuccess();case 13:case"end":return o.stop()}}),o)})));return function(e){return o.apply(this,arguments)}}())}}.bind(n))}.bind(this));case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"deleteKeyFromDb",value:function(){var e=Object(s.a)(r.a.mark((function e(){var t,n,o;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=this.state,n=t.deleteKey,o=t.keys,A(n)){e.next=5;break}return e.next=4,fetch("https://moneybirdproxymaatwerk.azurewebsites.net/api/key/".concat(n),{mode:"cors",method:"DELETE"});case 4:this.setState({deleteKey:null,apiKey:"",keys:o.filter((function(e){return e.key!=n}))});case 5:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"createKeyEntry",value:function(e){var t=this;return{content:j("div",null,j("span",{style:{cursor:"pointer"},class:"lnr lnr-trash",onClick:function(){return t.setState({deleteKey:e})}})," - ",j("span",{style:{cursor:"pointer"},onClick:function(){return t.handleToken(e)}},e)),key:e}}},{key:"getOptions",value:function(){return this.state.contacts.map((function(e){return{content:e.company_name,value:e.id}}))}},{key:"render",value:function(){var e=this,t=this.state,n=t.contacts,a=t.contact,r=t.admins,s=(t.admin,t.apiKey),i=t.keys,c=t.isOpen,l=t.locale,u=t.loadingContacts,d=(t.showApiKeys,t.deleteKey),p=t.forHours,h=t.forInvoices,O=t.forQuotes;console.log({locale:l});var C=l?I[l.split("-")[0]]:null;return j("div",null,j(T.a,null,j("script",{src:"https://statics.teams.cdn.office.net/sdk/v1.6.0/js/MicrosoftTeams.min.js"}),j("link",{rel:"stylesheet",href:"https://cdn.linearicons.com/free/1.0.0/icon-font.min.css"})),C?j(y.a,{theme:m.a},j("div",{style:P.mainPadding},j("div",{style:P.mainTable},j(b.a,{content:C.heading}),j(g.a,{gap:"gap.small",vAlign:"center",hAlign:"start"},j(k.a,{justifyContent:"center"},j("form",{style:{width:"100%"}},C.apiSection.title," ",j("br",null),C.apiSection.description,0==r?j(f.a.Fragment,null," ",j("br",null),j(v.a,{content:C.apiSection.fail,style:{background:"#cc4a31",color:"white",marginTop:"10px",marginBottom:"10px"}})):null,r?j(f.a.Fragment,null," ",j("br",null),j(v.a,{content:C.apiSection.succsess,style:{background:"#7fba00",color:"white",marginTop:"10px",marginBottom:"10px"}})):null,j(w.a,{items:i,placeholder:C.apiSection.placeholder,onOpenChange:function(){return e.setState({isOpen:!c})},name:"apiKey",id:"apiKey",clearable:s&&s.length>0,fluid:!0,search:!0,open:c,searchQuery:s,itemToString:function(e){return e?e.key:""},onSearchQueryChange:function(t,n){return e.setState({apiKey:n.searchQuery})},noResultsMessage:{content:"Add... ".concat(s),onClick:function(t){e.setState({isNew:!0,keys:[e.createKeyEntry(s)].concat(Object(o.a)(i)),isOpen:!1})},style:{cursor:"pointer"},active:!0}}),j("br",null),C.contactSection.title," ",j("br",null),C.contactSection.description,j(w.a,{ref:function(t){return e.drop=t},items:n?this.getOptions():[],value:a?a.content:null,placeholder:C.contactSection.placeholder,search:!0,loading:u,loadingMessage:"Loading...",onSearchQueryChange:this.getContacts,onChange:this.updateContact,name:"contact",disabled:!n,itemToString:function(e){return e?e.content:""},fluid:!0}),j("br",null),C.typeSection.title," ",j("br",null),C.typeSection.description," ",j("br",null),j(x.a,{label:C.types[0],checked:h,onChange:function(){return e.setState({forInvoices:!h})}}),j(x.a,{label:C.types[1],checked:O,onChange:function(){return e.setState({forQuotes:!O})}}),j(x.a,{label:C.types[2],checked:p,onChange:function(){return e.setState({forHours:!p})}}),j(S.a,{cancelButton:C.deleteDialog.cancel,onCancel:function(){return e.setState({deleteKey:null})},confirmButton:C.deleteDialog.confirm,onConfirm:this.deleteKeyFromDb,content:C.deleteDialog.message(d),header:C.deleteDialog.header,open:!A(d),backdrop:!0}))))))):null)}}]),n}(f.a.Component);t.default=K},Vrkf:function(e,t,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/connector",function(){return n("R+4x")}])}},[["Vrkf",0,2,1,3,7]]]);